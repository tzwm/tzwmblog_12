<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>又在重复造轮子了之rss2email | tzwm</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">tzwm's Blog</a></h1>
          </div>

          <div class="navbar">
              <ul>
                  
                  <li><span>
                      <a href="/">home </a>
                  </span></li>
                  

              </ul>
          </div>

          <h2 class="post">又在重复造轮子了之rss2email</h2>
<p class="meta">10 Sep 2013</p>

<div class="post">
<p>##Google Reader之死</p>

<p>会想要重复造这么个轮子，当然还是因为Google Reader之死。Google也不知抽了什么风，也许是为Google Plus让步，也许是对未来方向的执着，也许是各种各样的原因，反正在众怒之下还是坚决关闭了Google Reader。看到“Thank you for stopping by”的那一刻，我真是有种从粉转黑的感觉。</p>

<p>真正开始用Google Reader应该是在2010年1月。从订阅像Matrix67，月光博客这些很有名的blog开始，逐渐的习惯了在Google Reader里阅读。订阅量也从几个十几个飞涨到了上百个，他去世之前，我订阅条目是200多，阅读了将近6w个条目。遥想当年，吃过晚饭后回到机房，首先就是打开GReader，不管其它先看到7点钟再去搞学习。这种晚饭后扫GReader的习惯陪伴了我很久，直到他去世。在他去世之后的很长一段时间里，我在晚饭后都是处于迷茫、空白状态。</p>

<p>他的去世，最让可惜的，我觉得还是这么多年来储存的无数数据。想当年微薄还没有流行，blog还很红火的时候，好的文章也是层出不穷。这么多年过去，难免很多blog因为各种各样的原因不存在了。有GReader可以很方便的看到subscription的历史文章，但现在这些都不存在了……</p>

<p>##寻找替代品</p>

<p>不得不说GReader去世之后，真的是冒出来了茫茫多的RSS阅读器，这也足以证明他当年有多么可怕，真的是一统江湖，可惜没有千秋万载。</p>

<p>寻找替代品的路上，让我现在还印象比较深的，就是feedly、The Old Reader还有digg和AOL的reader这些。The Old Reader正如其名，是最像GReader的，但我最后没有选择他的原因也很简单，就是担心过不了多久就会撑不下去。其它的那些reader，总是让我不太习惯，有的还没有非常非常重要的全文搜索功能，总之是各种不满意。最后还是选择了feedly一直用到现在，但其实使用量已经远不如以前用GReader的时候了。</p>

<p>##想法</p>

<p>因为不满意各种替代品，也可能因为一些怨念，我就开始又想要重复造轮子，来打造个让自己满意的RSS阅读器。</p>

<p>在我看来，作为RSS阅读器比较重要的一些特性是如下几点：</p>

<ol>
  <li>稳定，能长久保存历史数据</li>
  <li>全文搜索</li>
  <li>快捷键</li>
  <li>多平台支持</li>
</ol>

<p>要我自己来做到这点，显然是非常困难的，在有限时间内几乎不可实现。但后来想到了GMail，这个也是我每天必用的Google产品。能很好的满足以上的几点要求，而且在界面上来说，也跟GReader很类似，从习惯上来说转移代价也会比较小。所以，我打算做的就比较简单了。只要写个服务端获取RSS，然后通过邮件发送到阅读用的GMail，最后通过GMail的Label来区分条目和分组就好了。（当然，其实连GMail都不能保证能一直活下去的，笑）</p>

<p>##方案</p>

<p>我首先想到的是用GAE作为服务端，可以用cron来获取RSS，也有接口来发邮件，非常方便。但还好我去仔细看了下他的配额限制，每天只有一百封的邮件发送配额，实在是不可能满足我的要求。最后我就考虑直接用我的Raspberry Pi来做服务器算了。而考虑用什么写，我没什么犹豫就选了Python，感觉也没什么理由，方便而已。</p>

<p>当我把RSS作为邮件一封封发送过去之后，很显然还需要对每封邮件进行分类。这点我用的是Google Script，他提供了比较方便的API来控制GMail。</p>

<p>##用到的一些东西</p>

<ol>
  <li>ConfigParser: 我之前很傻的把配置信息写在了程序里，然后每次git之前都要删掉，非常的麻烦和不专业，最后用了一个ini作为配置文件就解决了，这个是用来解析配置文件的</li>
  <li>smtplib: 用来登录、发邮件等</li>
  <li>logging, base.log: 用来在终端输出比较友好的提示信息</li>
  <li>md5: 我存了每个订阅当前条目的MD5，来判断更新到何处</li>
  <li>ElementTree: 我把订阅信息还有更新等都存在一个XML里，这个是用来解析XML，很方便</li>
  <li>feedparse: 用来解析RSS</li>
</ol>

<p>##成果</p>

<p>最后，我就弄出来了这么个东西： <a href="https://github.com/tzwm/rss2email/">rss2email</a>。</p>

<p>这里有两个Python文件，其中rss2email是主要的，greader2xml是用来把greader备份的XML文件转换成我需要的XML格式。HandleGMail是用来处理邮件的Google Script。</p>

<p>代码也重构了很多次，怎么都不满意，成果也是不太满意，只是勉强达到能用的程度。</p>

<p>##使用方法</p>

<p>因为我也没想要正式发布，所以使用方法就先简略写写了，作为程序员，我是不太喜欢写文档的，你们懂的。</p>

<ol>
  <li>config.ini是配置文件，我默认设置的是GMaild的SMTP，具体的填写可以看config.ini.sample文件</li>
  <li>订阅信息我是存在rsslist.xml里，这个你可以手动修改，格式参考rsslist.xml.sample，也可以通过执行greader2xml.py，来把同目录下的subscriptions.xml(GReader导出的)自动转换为rsslist.xml</li>
  <li>最后执行rss2list.xml就行了，执行的过程中会有提示信息</li>
</ol>

<p>还有问题，可以直接邮件问我。</p>

<p>##不足</p>

<ol>
  <li>我是使用GMail的SMTP来发送邮件，但每天好像也有500的上限，真是吐槽不能，凑合着用还是够了</li>
  <li>Google Script也有一些限制，比如对GMail的API调用限制，还有一定时间内的调用限制</li>
  <li>我用Python获取RSS的速度实在有点慢，比如我200多条订阅，每个获取不超过10个条目，都需要大概2个多小时才能搞完，让我无法忍</li>
  <li>写得有点丑，不忍直视的感觉，但不知改进，求大牛点醒</li>
  <li>……</li>
</ol>

<p>##Roadmap</p>

<ol>
  <li>使用多个邮箱来发送或者自己搭建一个Email Server，来解决邮件发送限制</li>
  <li>优化一下HandleGmail那个脚本</li>
  <li>……</li>
</ol>

<p>##后话</p>

<p>其实，自从Google挂掉以后，我对于RSS的依赖性大大降低，花在上面的时间至少减少了90%（这大概是Google想看到的吧，笑）。也是因为如此，这个重复造轮子的项目，我也不会很勤奋的更新下去，只能算是我自己发泄怨念的一个玩具吧。对于Google Reader之死，最让我感慨的就是，没有什么服务是永恒的，像Evernote那样宣称要做百年公司的，现在看来真是业界良心啊。连Google都能这么不靠谱，其实也没什么可以信赖的了，一切都要掌握在自己手中才是王道。</p>

<p>##推荐</p>

<ol>
  <li><a href="http://blog.devep.net/virushuo/2013/03/19/googlereader.html">Google的社会化梦想与Reader</a></li>
  <li><a href="http://lyric.im/individualism-on-internet/">互联网个人主义</a></li>
</ol>


</div>

    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'tzwmblog'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    


          <div class="footer">
            <div class="contact">
              <p>
                Samwise Wang<br />
                blog12@tzwm.me
              </p>
            </div>
            <div class="contact">
              <p>
                <a href="https://github.com/tzwm">github.com/tzwm</a><br />
                <a href="https://twitter.com/tzwm">twitter.com/tzwm</a><br />
              </p>
            </div>
          </div>
        </div>

    </body>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-32393367-2', 'tzwm.me');
  ga('send', 'pageview');

</script>

</html>
